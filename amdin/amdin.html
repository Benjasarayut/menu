<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; background: #f4f6f9; padding: 20px; }
        h1 { text-align: center; color: #333; }
        
        .grid-dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; max-width: 1000px; margin: 0 auto; }
        
        .table-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 2px solid transparent; min-height: 200px; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ß‡πà‡∏≤‡∏á (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
        .status-empty { border-color: #28a745; background-color: #f1fcf5; }
        .status-empty .header { color: #28a745; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ô‡∏±‡πà‡∏á (‡∏™‡∏µ‡πÅ‡∏î‡∏á) */
        .status-occupied { border-color: #dc3545; background-color: #fff5f5; }
        .status-occupied .header { color: #dc3545; }

        .header { font-size: 22px; font-weight: bold; display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        .order-list { flex-grow: 1; font-size: 14px; color: #555; max-height: 150px; overflow-y: auto; }
        .order-item { display: flex; justify-content: space-between; margin-bottom: 4px; }
        
        .footer { margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
        .total { font-weight: bold; font-size: 18px; text-align: right; margin-bottom: 10px; }
        
        .btn-clear { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-clear:hover { background: #218838; }

        @media (max-width: 768px) { .grid-dashboard { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>

    <h1>üñ•Ô∏è ‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞ (8 ‡πÇ‡∏ï‡πä‡∏∞)</h1>
    <div id="dashboard" class="grid-dashboard">Loading...</div>

    <script>
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (Real-time)
        setInterval(fetchData, 3000);
        fetchData();

        async function fetchData() {
            try {
                const res = await fetch('https://menu-tmrx.onrender.com/api/admin/tables');
                const tables = await res.json();
                renderDashboard(tables);
            } catch (err) { console.error("Loading error..."); }
        }

        function renderDashboard(tables) {
            const container = document.getElementById("dashboard");
            let html = "";

            for (let i = 1; i <= 8; i++) {
                const data = tables[i];
                const isEmpty = (data.status === 'empty');
                
                if (isEmpty) {
                    html += `
                    <div class="table-card status-empty">
                        <div class="header">‡πÇ‡∏ï‡πä‡∏∞ ${i} <span>‚úÖ ‡∏ß‡πà‡∏≤‡∏á</span></div>
                        <div style="text-align:center; color:#ccc; margin-top:40px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                    </div>`;
                } else {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
                    let listHtml = data.items.map(item => 
                        `<div class="order-item"><span>${item.name} x${item.qty}</span><span>${item.price * item.qty}</span></div>`
                    ).join('');

                    html += `
                    <div class="table-card status-occupied">
                        <div class="header">‡πÇ‡∏ï‡πä‡∏∞ ${i} <span>üî¥ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</span></div>
                        <div class="order-list">${listHtml}</div>
                        <div class="footer">
                            <div class="total">‡∏£‡∏ß‡∏°: ${data.total} ‡∏ö‡∏≤‡∏ó</div>
                            <button class="btn-clear" onclick="clearTable(${i})">üí∞ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
                        </div>
                    </div>`;
                }
            }
            container.innerHTML = html;
        }

        async function clearTable(num) {
            if(!confirm(`‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏ï‡πä‡∏∞ ${num} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß?`)) return;
            
            await fetch('https://menu-tmrx.onrender.com/api/admin/clear-table', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tableNo: num })
            });
            fetchData(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        }
    </script>
</body>
</html>