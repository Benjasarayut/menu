<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞ */
        .grid-tables-select { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .btn-table { aspect-ratio: 1/1; background: #fff; border: 2px solid #eee; border-radius: 15px; font-size: 24px; font-weight: bold; color: #333; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn-table:active { background: #06C755; color: white; border-color: #06C755; transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="tableSelectionPage" class="landing-container">
        <div class="welcome-box">
            <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png" alt="Logo" style="width:80px; margin-bottom:10px;">
            <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üôè</h1>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ï‡πä‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            
            <div class="grid-tables-select">
                <button class="btn-table" onclick="selectTable(1)">1</button>
                <button class="btn-table" onclick="selectTable(2)">2</button>
                <button class="btn-table" onclick="selectTable(3)">3</button>
                <button class="btn-table" onclick="selectTable(4)">4</button>
                <button class="btn-table" onclick="selectTable(5)">5</button>
                <button class="btn-table" onclick="selectTable(6)">6</button>
                <button class="btn-table" onclick="selectTable(7)">7</button>
                <button class="btn-table" onclick="selectTable(8)">8</button>
            </div>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="header-bar">
            <button onclick="location.reload()" class="btn-back">‚¨Ö ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏ï‡πä‡∏∞</button>
            <span class="badge" style="background: white; color: #333;">‡πÇ‡∏ï‡πä‡∏∞ <span id="displayTableNo" style="font-size:18px; color:red; font-weight:bold;">-</span></span>
        </div>
        <div class="container">
            <div id="menuList" class="menu-grid"></div>
        </div>
        <div class="bottom-bar">
            <div class="total-price">‡∏£‡∏ß‡∏°: <span id="totalAmount" style="color:#06C755;">0</span> ‡∏ö‡∏≤‡∏ó</div>
            <button id="btnCheckout" class="btn-checkout" onclick="submitOrder()" disabled>‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
    </div>

    <script>
        let myTable = null;
        let cart = {};
        
        // ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
        const menuItems = [
            { id: 1, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°", price: 50 },
            { id: 2, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î", price: 50 },
            { id: 3, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ú‡∏™‡∏°", price: 60 },
            { id: 4, name: "‡πÇ‡∏£‡∏ï‡∏µ‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°", price: 40 },
            { id: 5, name: "‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏¢‡πá‡∏ô", price: 25 },
            { id: 6, name: "‡πÄ‡∏•‡πâ‡∏á‡πÅ‡∏ã‡πà‡∏ö", price: 80 }
        ];

        function selectTable(num) {
            myTable = num;
            document.getElementById("tableSelectionPage").style.display = "none";
            document.getElementById("mainApp").style.display = "block";
            document.getElementById("displayTableNo").innerText = num;
            renderMenu();
        }

        function renderMenu() {
            const container = document.getElementById("menuList");
            container.innerHTML = menuItems.map(item => `
                <div class="menu-item">
                    <div class="menu-info"><h3>${item.name}</h3><div class="price">${item.price} ‡∏ö‡∏≤‡∏ó</div></div>
                    <div class="qty-controls">
                        <button class="btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                        <span class="qty-display" id="qty-${item.id}">0</span>
                        <button class="btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>
            `).join('');
        }

        function updateQty(id, change) {
            if (!cart[id]) cart[id] = 0;
            cart[id] += change;
            if (cart[id] < 0) cart[id] = 0;
            document.getElementById(`qty-${id}`).innerText = cart[id];
            
            let total = 0, count = 0;
            menuItems.forEach(item => { if(cart[item.id]) { total += item.price * cart[item.id]; count += cart[item.id]; } });
            document.getElementById("totalAmount").innerText = total;
            document.getElementById("btnCheckout").disabled = (count === 0);
        }

        async function submitOrder() {
            if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡πÇ‡∏ï‡πä‡∏∞ ${myTable} ?`)) return;

            let orderItems = [];
            menuItems.forEach(item => {
                if (cart[item.id] > 0) {
                    orderItems.push({ name: item.name, qty: cart[item.id], price: item.price });
                }
            });

            try {
                // ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Render
                const res = await fetch('https://menu-tmrx.onrender.com/api/order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tableNo: myTable,
                        items: orderItems,
                        total: document.getElementById("totalAmount").innerText
                    })
                });
                const result = await res.json();
                
                if(result.status === 'success') {
                    alert("‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏£‡∏±‡∏ö");
                    location.reload(); 
                } else {
                    alert("‚ùå Error: " + result.message);
                }
            } catch(err) { alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ"); }
        }
    </script>
</body>
</html>