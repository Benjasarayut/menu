<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #d32f2f; --bg: #fff5f5; --card: #ffffff; --text: #333; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        
        .main-card { width: 100%; max-width: 480px; background: var(--card); box-shadow: 0 10px 30px rgba(0,0,0,0.1); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Header ‡∏™‡∏ß‡∏¢‡πÜ */
        .header { background: var(--primary); color: white; padding: 25px 20px; text-align: center; border-radius: 0 0 20px 20px; box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3); }
        .header h1 { margin: 0; font-size: 22px; font-weight: 600; }
        .header p { margin: 5px 0 0; font-size: 14px; opacity: 0.9; }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞ */
        .content { padding: 20px; flex-grow: 1; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; color: var(--text); border-left: 4px solid var(--primary); padding-left: 10px; }
        
        .table-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .btn-table { 
            background: white; border: 2px solid #eee; border-radius: 12px; padding: 15px 0; 
            font-size: 18px; font-weight: 600; color: #555; cursor: pointer; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn-table span { font-size: 10px; font-weight: normal; color: #999; margin-top: 5px; }
        .btn-table:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .btn-table:active { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-table:active span { color: rgba(255,255,255,0.8); }

        /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ */
        .menu-list { display: flex; flex-direction: column; gap: 15px; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #f0f0f0; border-radius: 12px; background: white; }
        .menu-info h3 { margin: 0; font-size: 16px; color: #333; }
        .price { color: var(--primary); font-weight: bold; margin-top: 5px; }
        
        .qty-box { display: flex; align-items: center; background: #f9f9f9; border-radius: 20px; padding: 2px; }
        .btn-qty { width: 30px; height: 30px; border: none; background: white; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; color: var(--primary); font-weight: bold; }
        .qty-num { width: 30px; text-align: center; font-weight: bold; font-size: 14px; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
        .bottom-bar { position: sticky; bottom: 0; background: white; padding: 15px 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); border-radius: 20px 20px 0 0; }
        .btn-checkout { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(211, 47, 47, 0.4); opacity: 0.5; pointer-events: none; transition: 0.3s; }
        .btn-checkout.active { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <div id="pageTable" class="main-card">
        <div class="header">
            <h1>‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏ï‡∏µ üçó</h1>
            <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Customer Portal</p>
        </div>
        <div class="content">
            <div class="section-title">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ï‡πä‡∏∞</div>
            <div class="table-grid">
                <button class="btn-table" onclick="selectTable(1)">01<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(2)">02<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(3)">03<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(4)">04<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(5)">05<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(6)">06<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(7)">07<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
                <button class="btn-table" onclick="selectTable(8)">08<span>‡∏ß‡πà‡∏≤‡∏á</span></button>
            </div>
        </div>
    </div>

    <div id="pageMenu" class="main-card" style="display: none;">
        <div class="header" style="display:flex; justify-content: space-between; align-items: center; padding: 15px 20px;">
            <div onclick="location.reload()" style="cursor:pointer; font-size:20px;">‚¨Ö</div>
            <div>
                <h1 style="font-size:18px;">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
                <p>‡πÇ‡∏ï‡πä‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå <span id="displayTable" style="font-weight:bold; color:#fff0c4;">-</span></p>
            </div>
            <div style="width:20px;"></div>
        </div>
        <div class="content">
            <div class="section-title">‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
            <div id="menuContainer" class="menu-list"></div>
        </div>
        <div class="bottom-bar">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold;">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span> <span id="totalPrice" style="color:var(--primary)">0 ‡∏ö‡∏≤‡∏ó</span>
            </div>
            <button id="btnOrder" class="btn-checkout" onclick="confirmOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
    </div>

    <script>
        let currentTable = null;
        let cart = {};
        const menuItems = [
            { id: 1, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ï‡πâ‡∏°", price: 50 }, { id: 2, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î", price: 50 },
            { id: 3, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà‡∏ú‡∏™‡∏°", price: 60 }, { id: 4, name: "‡πÇ‡∏£‡∏ï‡∏µ‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°", price: 40 },
            { id: 5, name: "‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏¢‡πá‡∏ô", price: 25 }, { id: 6, name: "‡πÄ‡∏•‡πâ‡∏á‡πÅ‡∏ã‡πà‡∏ö", price: 80 }
        ];

        function selectTable(num) {
            currentTable = num;
            document.getElementById("pageTable").style.display = "none";
            document.getElementById("pageMenu").style.display = "flex";
            document.getElementById("displayTable").innerText = num.toString().padStart(2, '0');
            renderMenu();
        }

        function renderMenu() {
            const container = document.getElementById("menuContainer");
            container.innerHTML = menuItems.map(item => `
                <div class="menu-item">
                    <div class="menu-info"><h3>${item.name}</h3><div class="price">${item.price}.-</div></div>
                    <div class="qty-box">
                        <button class="btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                        <div class="qty-num" id="qty-${item.id}">0</div>
                        <button class="btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>
            `).join('');
        }

        function updateQty(id, change) {
            if (!cart[id]) cart[id] = 0;
            cart[id] += change;
            if (cart[id] < 0) cart[id] = 0;
            document.getElementById(`qty-${id}`).innerText = cart[id];
            
            let total = 0, count = 0;
            menuItems.forEach(item => { if(cart[item.id]) { total += item.price * cart[item.id]; count += cart[item.id]; } });
            document.getElementById("totalPrice").innerText = total + " ‡∏ö‡∏≤‡∏ó";
            
            const btn = document.getElementById("btnOrder");
            if(count > 0) btn.classList.add("active"); else btn.classList.remove("active");
        }

        async function confirmOrder() {
            if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£?`)) return;
            let items = [];
            menuItems.forEach(i => { if(cart[i.id]>0) items.push({name: i.name, qty: cart[i.id], price: i.price}) });
            
            try {
                await fetch('https://menu-tmrx.onrender.com/api/order', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ tableNo: currentTable, items: items, total: parseInt(document.getElementById("totalPrice").innerText) })
                });
                alert("‚úÖ ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"); location.reload();
            } catch(e) { alert("Error connecting to server"); }
        }
    </script>
</body>
</html>